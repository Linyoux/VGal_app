<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VGal 游戏启动器</title>
    <link rel="stylesheet" href="theme.css">
    <style>
        .card-grid {
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        }
        .card-actions {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            gap: 10px;
            padding: 15px;
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0) 100%);
            transform: translateY(100%);
            transition: transform var(--transition-speed) ease;
        }
        .card:hover .card-actions {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="page-title">游戏列表</h1>
        <div id="loading-indicator" style="text-align: center; padding: 40px; display: none;">正在加载游戏...</div>
        <div class="card-grid" id="game-container">
            <!-- 游戏列表将动态添加到这里 -->
        </div>
    </div>

    <script>
        const DEFAULT_ICON_BG = 'about:blank'; // 使用空白背景代替占位图

        document.addEventListener('DOMContentLoaded', () => {
            loadGames();
        });

        function loadGames() {
            const container = document.getElementById('game-container');
            const loadingIndicator = document.getElementById('loading-indicator');
            
            container.innerHTML = '';
            loadingIndicator.style.display = 'block';

            // 使用setTimeout模拟异步加载，给原生代码响应时间
            setTimeout(() => {
                try {
                    const games = JSON.parse(VGAL.getGames());
                    loadingIndicator.style.display = 'none';

                    if (games.length === 0) {
                        container.innerHTML = '<p style="text-align:center; color: var(--text-muted);">未找到任何游戏。请将游戏文件夹放置在 vgal/ 目录下。</p>';
                        return;
                    }

                    games.forEach(game => {
                        const card = document.createElement('div');
                        card.className = 'card';
                        card.onclick = () => VGAL.startGame(game.name);

                        const img = document.createElement('img');
                        img.className = 'card-image';
                        img.src = game.icon ? `file://${game.icon}` : DEFAULT_ICON_BG;
                        img.alt = game.name;
                        img.onerror = () => { 
                            img.src = DEFAULT_ICON_BG; 
                            img.style.backgroundColor = '#000';
                        };

                        const body = document.createElement('div');
                        body.className = 'card-body';
                        
                        const title = document.createElement('h3');
                        title.className = 'card-title';
                        title.textContent = game.name;

                        const actions = document.createElement('div');
                        actions.className = 'card-actions';

                        const startButton = document.createElement('button');
                        startButton.className = 'btn btn-primary';
                        startButton.textContent = '启动游戏';
                        startButton.style.flex = '2'; // 占据更多空间
                        startButton.onclick = (e) => {
                            e.stopPropagation();
                            VGAL.startGame(game.name);
                        };

                        const loadButton = document.createElement('button');
                        loadButton.className = 'btn btn-secondary';
                        loadButton.textContent = '读档';
                        loadButton.style.flex = '1';
                        loadButton.onclick = (e) => {
                            e.stopPropagation();
                            VGAL.openLoadData(game.name);
                        };

                        actions.appendChild(startButton);
actions.appendChild(loadButton);

                        body.appendChild(title);
                        card.appendChild(img);
                        card.appendChild(body);
                        card.appendChild(actions); // 将按钮层放在最上
                        container.appendChild(card);
                    });
                } catch (e) {
                    loadingIndicator.style.display = 'none';
                    container.innerHTML = `<p style="text-align:center; color: var(--danger-color);">加载游戏列表时出错: ${e.message}</p>`;
                    console.error(e);
                }
            }, 100); // 延迟100毫秒执行
        }
    </script>
</body>
</html>
